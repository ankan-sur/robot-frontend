================================================================================
HFH ROBOT DASHBOARD - FRONTEND DOCUMENTATION
================================================================================
Comprehensive Documentation for Review with ChatGPT and Team
Generated: 2024

================================================================================
TABLE OF CONTENTS
================================================================================

1. OVERVIEW
2. ARCHITECTURE
3. ROS TOPICS & INTEGRATION
4. UI COMPONENTS
5. FEATURES & FUNCTIONALITY
6. COLOR SCHEME & DESIGN
7. STATE MANAGEMENT
8. CONFIGURATION
9. DEPENDENCIES
10. SETUP & USAGE
11. RECENT CHANGES
12. FUTURE ENHANCEMENTS

================================================================================
1. OVERVIEW
================================================================================

The HFH Robot Dashboard is a React-based web application that provides a
real-time interface for monitoring and controlling a ROS2-based robot. The
dashboard connects to ROS via rosbridge (WebSocket) and displays telemetry,
navigation maps, camera feeds, and control interfaces.

Key Technologies:
- React 18.3.1 with TypeScript
- Vite 5.4.10 for build tooling
- Tailwind CSS 3.4.13 for styling
- ROSLIB.js 1.3.0 for ROS bridge communication
- WebSocket-based real-time communication

================================================================================
2. ARCHITECTURE
================================================================================

2.1 PROJECT STRUCTURE
-------------------
frontend/
├── src/
│   ├── components/          # React UI components
│   │   ├── Controls.tsx     # Navigation controls and stop button
│   │   ├── Dashboard.tsx    # Legacy dashboard (may be unused)
│   │   ├── DebugPanel.tsx   # Map switching and debug tools
│   │   ├── Header.tsx       # Top navigation bar
│   │   ├── MapView.tsx      # Occupancy grid map visualization
│   │   ├── TelemetryPanel.tsx # Real-time robot status display
│   │   └── VideoFeed.tsx    # Camera stream display
│   ├── ros/                 # ROS integration layer
│   │   ├── config.ts        # ROS topic/service/action configuration
│   │   ├── hooks.ts         # React hooks for ROS topics
│   │   └── ros.ts           # ROSLIB connection management
│   ├── hooks/
│   │   └── useTelemetry.ts  # Legacy telemetry hook (may be unused)
│   ├── lib/
│   │   └── api.ts            # HTTP API client (legacy)
│   ├── App.tsx               # Main application component
│   ├── main.tsx              # Application entry point
│   └── index.css             # Global styles
└── package.json               # Dependencies and scripts

2.2 COMPONENT HIERARCHY
----------------------
App
├── Header
└── main
    ├── MapView
    ├── VideoFeed
    ├── DebugPanel
    ├── Controls
    └── TelemetryPanel

2.3 DATA FLOW
------------
1. ROS topics publish data → ROS2 system
2. rosbridge_server converts to WebSocket messages
3. ROSLIB.js receives WebSocket messages
4. React hooks subscribe to topics and update state
5. Components re-render with new data

================================================================================
3. ROS TOPICS & INTEGRATION
================================================================================

3.1 SUBSCRIBED TOPICS (Reading from ROS)
----------------------------------------

/odom (nav_msgs/Odometry)
  - Robot position, orientation, and velocity
  - Used by: MapView, TelemetryPanel
  - Updates: Position (x, y, z), orientation (quaternion), velocity

/ros_robot_controller/battery (std_msgs/UInt16)
  - Battery voltage in millivolts (e.g., 8365 = 8.365V)
  - Converted to percentage: 6000mV (0%) to 8400mV (100%)
  - Used by: TelemetryPanel
  - Display: Battery percentage with color-coded progress bar

/imu/rpy/filtered (geometry_msgs/Vector3)
  - IMU orientation: Roll, Pitch, Yaw in radians
  - Used by: TelemetryPanel
  - Display: Converted to degrees, shown in orientation section

/ros_robot_controller/button (std_msgs/Bool)
  - Hardware button state (pressed/released)
  - Used by: TelemetryPanel
  - Display: Visual indicator with pressed/released status

/robot/state (std_msgs/String)
  - Robot operational state: "idle", "navigating", "error", etc.
  - Used by: TelemetryPanel
  - Normalization handled in useRobotState()

/joint_states (sensor_msgs/JointState)
  - Servo/joint positions, velocities, efforts
  - Hook created but not currently displayed
  - Available for future use

/map (nav_msgs/OccupancyGrid)
  - SLAM map for navigation
  - Used by: MapView
  - Display: Canvas-based map with robot position overlay

/pois (interfaces/Points)
  - Points of Interest in pixel coordinates for UI overlays
  - Used by: Controls (picker), MapView (overlay)
  - Accepts multiple formats (JSON string/std_msgs/String or structured arrays); normalized in usePointsOfInterest()

3.2 PUBLISHED TOPICS (Writing to ROS)
-------------------------------------

/cmd_vel (geometry_msgs/Twist)
  - Robot velocity commands
  - Published by: Controls (via useCmdVel hook)
  - Auto-stop: Sends zero velocity after 300ms of no command

3.3 SERVICES
------------

/navigate_to_pose/cancel (action_msgs/CancelGoal)
  - Cancel active Nav2 goal(s)
  - Provide goal_id(s) from /navigate_to_pose/status; if none, cancel all

3.4 ACTIONS
-----------

/navigate_to_pose (nav2_msgs/NavigateToPose)
  - Navigate robot to a specific pose
  - Used by: Controls (goToLab function)
  - Goal: Position (x, y) and orientation (yaw)

3.5 TOPIC CONFIGURATION
-----------------------
All topics are configured in: frontend/src/ros/config.ts

To add new topics:
1. Add topic name to ROS_CONFIG.topics
2. Add message type to ROS_CONFIG.messageTypes
3. Create a hook in frontend/src/ros/hooks.ts
4. Use the hook in components

================================================================================
4. UI COMPONENTS
================================================================================

4.1 HEADER
----------
Location: frontend/src/components/Header.tsx
Purpose: Top navigation bar with application title
Features:
- Gradient background (purple → pink → rose)
- Sticky positioning
- Title display

4.2 CONTROLS
------------
Location: frontend/src/components/Controls.tsx
Purpose: Robot navigation and stop controls
Features:
- Destination selector (dropdown of POIs from /pois)
- "Go" button sends Nav2 goal (pixel→world conversion based on /map)
- "Stop" button always available as safety (publishes zero cmd_vel)

Key Logic:
- Uses usePointsOfInterest() and useNavigateToPose()
- Converts selected POI from pixel to map coordinates using map.info
- Stop publishes zero cmd_vel and cancels drift with auto-stop timer

4.3 TELEMETRY PANEL
-------------------
Location: frontend/src/components/TelemetryPanel.tsx
Purpose: Display real-time robot status and sensor data
Sections:
1. Robot State (NEW)
   - Shows: Idle, Responding to Command, Heading to Charger
   - Color-coded badges with animated indicators
   - Current command display when responding to command

2. Connection Status
   - ROS connection state (connected/disconnected)
   - Connection latency in milliseconds
   - Animated status indicator

3. Battery
   - Percentage display (converted from millivolts)
   - Color-coded progress bar:
     * Green: >50%
     * Yellow: 20-50%
     * Red: <20%
   - Gradient fill animation

4. Position
   - X, Y, Z coordinates from odometry
   - Updated in real-time

5. Velocity
   - Linear speed (m/s)
   - Angular velocity (rad/s)

6. Orientation (IMU) - Conditional
   - Roll, Pitch, Yaw in degrees
   - Only shown when IMU data available

7. Button State - Conditional
   - Hardware button pressed/released status
   - Only shown when button topic available

4.4 MAP VIEW
------------
Location: frontend/src/components/MapView.tsx
Purpose: Visualize navigation map and robot position
Features:
- Occupancy grid rendering on HTML5 canvas
- Robot pose overlay (triangle)
- POIs overlay from /pois (pixel coordinates)
- Color scheme: Unknown (gray), Free (white), Occupied (black)

4.5 VIDEO FEED
--------------
Location: frontend/src/components/VideoFeed.tsx
Purpose: Display live camera stream
Features:
- Uses web_video_server stream; falls back to stream_viewer link if MJPEG fails
- Sizes to the natural image dimensions (fits content)

4.6 DEBUG PANEL
---------------
Location: frontend/src/components/DebugPanel.tsx
Purpose: Development and debugging tools
Features:
- Map selection dropdown
- Change map button
- Error display
- Map source information

================================================================================
5. FEATURES & FUNCTIONALITY
================================================================================

5.1 ROBOT STATE MANAGEMENT
--------------------------
The dashboard tracks three robot states:
1. "idle" - Robot is not executing any commands
2. "responding_to_command" - Robot is executing a navigation command
3. "heading_to_charger" - Robot is autonomously going to charging station

State transitions affect:
- Stop button availability (only enabled during "responding_to_command")
- Visual indicators (color-coded badges)
- Current command display

5.2 BATTERY MONITORING
----------------------
- Reads battery voltage in millivolts from ROS topic
- Converts to percentage using 2S LiPo voltage range:
  * 6000mV = 0% (empty)
  * 8400mV = 100% (fully charged)
- Linear interpolation between min/max
- Clamped to 0-100% range
- Color-coded visual feedback

5.3 NAVIGATION CONTROL
---------------------
- Point of Interest (POI) selection from dropdown
- Navigation via Nav2 action server
- Automatic error handling and user feedback
- Stop functionality for active commands only

5.4 REAL-TIME UPDATES
---------------------
- All telemetry updates via WebSocket (no polling)
- Automatic reconnection on connection loss
- Latency monitoring
- Connection state indicators

5.5 SAFETY FEATURES
-------------------
- Stop button only available when robot is actively responding
- Auto-stop if no cmd_vel commands for 300ms
- Connection state validation before commands
- Disabled controls when not connected

================================================================================
6. COLOR SCHEME & DESIGN
================================================================================

The UI uses a vibrant, modern color palette with gradients and animations.

6.1 COLOR THEMES BY COMPONENT
------------------------------

Header:
- Background: Purple → Pink → Rose gradient
- Border: Purple-500 (4px)

Controls:
- Background: White → Purple-50 gradient
- Border: Purple-400
- Go Button: Purple-600 → Pink-600 gradient
- Stop Button: Orange-500 → Red-600 gradient
- Control Status: Emerald (allowed) / Amber (disabled)

Telemetry Panel:
- Background: White → Cyan-50 gradient
- Border: Cyan-400
- Robot State:
  * Idle: Slate colors
  * Responding: Blue colors
  * Heading to Charger: Amber colors
- Connection: Emerald-Teal gradient
- Battery: Lime-Green gradient
- Position: Indigo-Purple gradient
- Velocity: Violet-Fuchsia gradient
- IMU: Rose-Pink gradient
- Button: Sky-Cyan gradient

Map View:
- Background: White → Emerald-50 gradient
- Border: Emerald-400
- Robot: Purple triangle, Pink direction line
- Position Badge: Purple → Pink gradient

Video Feed:
- Background: White → Violet-50 gradient
- Border: Violet-400
- Video Container: Violet-900 → Purple-900 gradient

Debug Panel:
- Background: White → Teal-50 gradient
- Border: Teal-400
- Button: Teal-600 → Cyan-600 gradient

App Background:
- Purple-50 → Pink-50 → Rose-50 gradient

6.2 DESIGN PRINCIPLES
---------------------
- Gradient backgrounds for depth
- Animated status indicators (pulse animation)
- Shadow effects for elevation
- Rounded corners (rounded-lg)
- Border widths: 2px for most, 4px for header
- Font weights: Medium for labels, Semibold for values, Bold for headings
- Gradient text for headings (bg-clip-text)

================================================================================
7. STATE MANAGEMENT
================================================================================

7.1 REACT HOOKS ARCHITECTURE
----------------------------
All ROS data is managed through custom React hooks in frontend/src/ros/hooks.ts:

- useRosConnection() - Connection state and latency
- useBattery() - Battery percentage
- useOdom() - Odometry data
- useIMURPY() - IMU orientation
- useButton() - Button state
- useRobotState() - Robot operational state
- useJointStates() - Joint positions (available, not displayed)
- useMap() - Occupancy grid map
- usePointsOfInterest() - POI list
- useCmdVel() - Velocity command sender
- useNavigateToPose() - Navigation action client

7.2 STATE LIFECYCLE
-------------------
1. Component mounts → Hook initializes
2. ROS connection check → If connected, subscribe to topic
3. Topic receives message → Update React state
4. Component re-renders with new data
5. Component unmounts → Unsubscribe from topic

7.3 CONNECTION MANAGEMENT
-------------------------
- Centralized in frontend/src/ros/ros.ts
- Automatic reconnection on disconnect
- Connection state shared across all hooks
- State: 'disconnected' | 'connecting' | 'connected'

================================================================================
8. CONFIGURATION
================================================================================

8.1 ROS CONFIGURATION
---------------------
File: frontend/src/ros/config.ts

Environment Variables:
- VITE_ROSBRIDGE_URL: WebSocket URL (default auto from host → ws://<host>:9090)
- VITE_VIDEO_BASE: Video server URL (default auto from host → http://<host>:8080)

Topic Configuration:
- All topics, services, and actions are centrally defined
- Message types specified for each topic
- Easy to add/modify topics

8.2 BUILD CONFIGURATION
-----------------------
File: frontend/vite.config.ts
- Port: 5173
- Host: true (accessible on network)
- React plugin enabled

8.3 STYLING CONFIGURATION
-------------------------
File: frontend/tailwind.config.js
- Tailwind CSS configuration
- Custom color palette (using Tailwind defaults)

================================================================================
9. DEPENDENCIES
================================================================================

9.1 PRODUCTION DEPENDENCIES
---------------------------
- react: 18.3.1 - UI framework
- react-dom: 18.3.1 - React DOM rendering
- roslib: ^1.3.0 - ROS bridge JavaScript library

9.2 DEVELOPMENT DEPENDENCIES
-----------------------------
- @types/react: 18.3.5 - TypeScript types
- @types/react-dom: 18.3.0 - TypeScript types
- @vitejs/plugin-react: ^5.1.0 - Vite React plugin
- @types/roslib: ^1.0.0 - TypeScript types for ROSLIB
- autoprefixer: 10.4.20 - CSS autoprefixer
- postcss: 8.4.47 - CSS post-processor
- tailwindcss: 3.4.13 - Utility-first CSS framework
- typescript: 5.6.3 - TypeScript compiler
- vite: 5.4.10 - Build tool and dev server

================================================================================
10. SETUP & USAGE
================================================================================

10.1 INSTALLATION
-----------------
cd frontend
npm install

10.2 DEVELOPMENT
----------------
npm run dev -- --host
- Starts Vite dev server on http://<host>:5173 (LAN-accessible)
- Open http://fordward.local:5173 when running on robot network

10.3 BUILD
----------
npm run build
- Creates production build in dist/
- Optimized and minified

10.4 PREVIEW
-----------
npm run preview
- Serves production build locally
- Useful for testing production build

10.5 PERMISSIONS (Ubuntu/Linux)
-------------------------------
If permission errors occur after git pull:
chmod -R u+w node_modules 2>/dev/null || true
chmod +x node_modules/.bin/*

Or reinstall:
rm -rf node_modules package-lock.json
npm install

10.6 ROS SETUP REQUIREMENTS
---------------------------
1. rosbridge_server running on ROS2 system
   - Default port: 9090
   - WebSocket protocol

2. Required ROS topics publishing:
   - /odom
   - /ros_robot_controller/battery
   - /robot_state (NEW - must be implemented)
   - /current_command (NEW - must be implemented)
   - /map (for navigation)
   - /pois (for destination selection)

3. Nav2 action server:
   - /navigate_to_pose action must be available

4. Camera stream (optional):
   - web_video_server running
   - /ascamera/camera_publisher/rgb0/image topic

================================================================================
11. RECENT CHANGES
================================================================================

11.1 STOP BUTTON ENHANCEMENTS
------------------------------
- Changed "Emergency Stop" to "Stop"
- Button only enabled when robot is responding to command
- Disabled when robot is idle or heading to charger
- Uses robot state from /robot_state topic

11.2 ROBOT STATE DISPLAY
------------------------
- Added robot state visualization in TelemetryPanel
- Three states: Idle, Responding to Command, Heading to Charger
- Color-coded badges with animated indicators
- Current command display when responding

11.3 CURRENT COMMAND DISPLAY
-----------------------------
- Shows active command/destination when robot is responding
- Displays below robot state badge
- Format determined by behavior tree implementation

11.4 UI COLOR REFRESH
---------------------
- Updated all components with vibrant gradients
- Purple/Pink/Rose theme throughout
- Gradient backgrounds and borders
- Animated status indicators
- Enhanced shadows and depth

11.5 BATTERY CONVERSION FIX
----------------------------
- Fixed battery display to convert millivolts to percentage
- 2S LiPo voltage range: 6000mV (0%) to 8400mV (100%)
- Handles both percentage and millivolt input formats

11.6 NEW ROS HOOKS
------------------
- useRobotState() - Robot operational state
- useCurrentCommand() - Current command/destination
- Both hooks ready for behavior tree integration

================================================================================
12. FUTURE ENHANCEMENTS
================================================================================

12.1 REQUIRED IMPLEMENTATIONS
------------------------------
1. Behavior Tree Integration:
   - Publish to /robot_state topic with state values
   - Publish to /current_command topic with destination info
   - Format: std_msgs/String for both topics

2. State Values to Publish:
   - "idle" - when robot is waiting
   - "responding_to_command" - when executing navigation
   - "heading_to_charger" - when going to charger

3. Command Format:
   - Any descriptive string (e.g., "Lab 3", "Charging Station", "Room 101")
   - Published when state is "responding_to_command"
   - Cleared or set to empty when state changes

12.2 POTENTIAL ENHANCEMENTS
----------------------------
1. Joint States Display:
   - Show servo positions if robot has manipulator
   - Visual representation of joint angles

2. Diagnostics Display:
   - System health monitoring
   - Error/warning indicators
   - Component status

3. Historical Data:
   - Battery level over time
   - Path history on map
   - Command history log

4. Advanced Controls:
   - Manual velocity control
   - Waypoint setting
   - Emergency override (bypass state check)

5. Multi-Robot Support:
   - Select robot from list
   - Multiple map views
   - Robot-specific telemetry

6. Mobile Responsiveness:
   - Optimize for tablet/mobile
   - Touch-friendly controls
   - Responsive layout

================================================================================
13. TROUBLESHOOTING
================================================================================

13.1 COMMON ISSUES
------------------

Issue: "Permission denied" errors in Ubuntu
Solution: Run chmod commands or reinstall node_modules

Issue: Battery shows wrong percentage
Solution: Check voltage range in useBattery hook, adjust MIN/MAX if needed

Issue: Stop button not enabled
Solution: Verify /robot_state topic is publishing "responding_to_command"

Issue: Robot state not showing
Solution: Check /robot_state topic exists and is publishing std_msgs/String

Issue: Current command not displaying
Solution: Verify /current_command topic is publishing when robot is responding

Issue: Connection issues
Solution: Check rosbridge_server is running and accessible on network

Issue: Map not displaying
Solution: Verify /map topic is publishing nav_msgs/OccupancyGrid

Issue: Navigation not working
Solution: Check Nav2 is running and /navigate_to_pose action is available

13.2 DEBUGGING
--------------
- Check browser console for errors
- Verify ROS topics are publishing: ros2 topic list
- Check topic data: ros2 topic echo /topic_name
- Verify rosbridge connection: Check WebSocket in browser DevTools
- Check ROS node logs for errors

================================================================================
14. CODE STRUCTURE NOTES
================================================================================

14.1 FILE ORGANIZATION
----------------------
- Components: One component per file, PascalCase naming
- Hooks: Custom hooks in ros/hooks.ts, camelCase naming
- Types: Defined in hook files or component files
- Config: Centralized in ros/config.ts

14.2 NAMING CONVENTIONS
-----------------------
- Components: PascalCase (e.g., TelemetryPanel)
- Hooks: camelCase with "use" prefix (e.g., useBattery)
- Topics: snake_case (e.g., /robot_state)
- Variables: camelCase
- Constants: UPPER_SNAKE_CASE

14.3 STYLING APPROACH
---------------------
- Tailwind CSS utility classes
- No separate CSS files (except index.css)
- Gradient utilities for visual appeal
- Responsive design with Tailwind breakpoints

================================================================================
END OF DOCUMENTATION
================================================================================

For questions or issues, refer to:
- ROS2 documentation: https://docs.ros.org/
- ROSLIB.js docs: https://wiki.ros.org/roslibjs
- React documentation: https://react.dev/
- Tailwind CSS: https://tailwindcss.com/

Last Updated: 2024
Version: 1.0.0
